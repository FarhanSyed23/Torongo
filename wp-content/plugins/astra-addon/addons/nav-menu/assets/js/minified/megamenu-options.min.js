!function(u){AstMegaMenuAdmin={init:function(){u(document).ready(this._ready).on("click",".astra-megamenu-opts-btn",this._openSettingsModal).on("click",".astra-mm-modal-overlay, .astra-megamenu-cancel-btn, .astra-mm-options-wrap .astra-mm-close ",this._closeSettingsModal).on("click",".astra-megamenu-save-opts",this._saveMegamenuOptions).on("click",".astra-builder-upload-button",this._openMediaUploader).on("click",".ast-remove-button",this._removeUploadButton).on("change",".field-mm-enabled input",this._megaMenuOptionDependency).on("change",".field-mm-enabled-heading input",this._megaMenuHeadingOptionDependency).on("change",".ast-content-src",this._contentOptDependency).on("change",".field-mm-disable-label input",this._disableLabelOptionDependency).on("click",".ast-insert-widget",this._dropWidget).on("click",".astra-mm-options-wrap .widget-action",this._editWidget)},_openSettingsModal:function(){var i=u(this),s=(i.closest("div").find(".astra-mm-modal-overlay"),i.parents(".menu-item-settings")),e=i.closest("li.menu-item"),t=e.attr("class").split(" "),n=parseInt(e.attr("id").match(/[0-9]+/)[0],10),a=e.find(".ast-nonce-field").val(),d=u(".ast-popup-wrap"),o=e.find(".menu-item-title").text(),l=d.find(".ast-megamenu-spinner.spinner"),r=u(".astra-mm-options-wrap");u("html").css("overflow","hidden"),$popup_menu_item=d.data("menu_item"),l.addClass("is-active"),AstMegaMenuAdmin._addDepthClass(t);var m=i.parents(".menu-item").prevAll(".menu-item-depth-0").attr("id"),c=null;if(void 0!==m&&(c=m.replace(/[^0-9\.]/g,"")),n==$popup_menu_item)return l.removeClass("is-active"),d.css("display","flex"),void d.find(".astra-mm-options-wrap, .astra-mm-modal-overlay").show();d.find(".astra-mm-options-wrap div").css("visibility","hidden");var p={action:"ast_render_popup",menu_item_id:n,parent_id:c,security_nonce:a};d.css("display","flex"),d.find(".astra-mm-options-wrap, .astra-mm-modal-overlay").show(),u.post(ajaxurl,p,function(e){var t=e.data;l.removeClass("is-active"),d.find("astra-mm-options-wrap div").css("visibility","visible"),u(".ast-popup-wrap .astra-mm-options-wrap").html(t);var a=u(".ast-editing-label").data("label")+" "+o;u(".ast-editing-label").text(a),u(".ast-popup-wrap .astra-mm-options-wrap").data("menu-item",n),AstMegaMenuAdmin._initSelect2(r),r.find(".astra-wp-color-input").wpColorPicker(),AstMegaMenuAdmin._contentOptDependency(i,r),u(s).addClass("ast-active"),d.data("loaded",!0),d.data("menu_item",n),AstMegaMenuAdmin._renderSavedWidgets(r,n)})},_addDepthClass:function(e){for(var t="",a=0;a<e.length;a++){var i=/^menu-item\-(.+)/.exec(e[a]);if(null!=i){var s=i[1];-1!==s.indexOf("depth")&&(t="menu-item-"+s)}}u(".astra-mm-options-wrap").removeClass(function(e,t){return(t.match(/\bmenu-item-depth\S+/g)||[]).join(" ")}),u(".astra-mm-options-wrap").addClass(t)},_openMediaUploader:function(e){e.preventDefault();var t=u(this).data("id"),a=wp.media({title:"Insert image",library:{type:"image"},button:{text:"Use this image"},multiple:!1}).on("select",function(){var e=a.state().get("selection").first().toJSON();u("#edit-menu-item-megamenu-"+t).val(e.url),u("#astra-media-img-"+t).attr("src",e.url).css("display","block"),u("#astra-media-img-"+t).parents(".ast-media-img-container").addClass("ast-image-set")}).open()},_closeSettingsModal:function(){u("html").css("overflow","unset"),u(".menu-item-settings").removeClass("ast-active"),u(".astra-mm-modal-overlay").hide(),u(".astra-mm-options-wrap").hide(),u(".ast-popup-wrap").hide(),u(".ast-popup-wrap").find(".spinner").removeClass("is-active")},_initSelect2:function(e){e.find(".ast-select2-container").astselect2({placeholder:astMegamenuVars.select2_placeholder,ajax:{url:ajaxurl,dataType:"json",method:"post",delay:250,data:function(e){return{q:e.term,page:e.page,action:"ast_get_posts_list",nonce:astRules.ajax_nonce}},processResults:function(e){return{results:e}},cache:!0},minimumInputLength:2,language:astRules.ast_lang})},_removeUploadButton:function(){var e=u(this).parents(".ast-media-img-container");e.find("img").attr("src",""),e.find(".astra-builder-upload-field").val(""),e.removeClass("ast-image-set")},_megaMenuHeadingOptionDependency:function(){var e=u(this),t=e.prop("checked"),a=u(".field-mm-header-sep-color");t?e.parents(".astra-mm-options-wrap").hasClass("menu-item-depth-0")||a.show():a.hide()},_megaMenuOptionDependency:function(){var e=u(this),t=e.prop("checked"),a=u(".field-mm-megamenu-opts .field-mm-width"),i=u(".bg-image-container, .field-mm-color"),s=u(".field-mm-content-src");t?(a.show(),i.show(),e.parents(".astra-mm-options-wrap").hasClass("menu-item-depth-0")||s.show()):(a.hide(),i.hide(),s.hide())},_disableLabelOptionDependency:function(){var e=u(this).prop("checked"),t=u(".field-mm-disable-link");e?t.hide():t.show()},_contentOptDependency:function(e,t){if(u(".field-mm-template").hide(),u(".field-mm-custom-text").hide(),u(".field-mm-widget-option").hide(),u(".field-mm-widget-area").hide(),void 0!==t)var a=t.find(".ast-content-src").val(),i=t.find(".ast-mm-settings");else a=u(this).val(),i=u(this).closest(".ast-mm-settings");switch(a){case"template":i.find(".field-mm-template").show();break;case"custom_text":i.find(".field-mm-custom-text").show();break;case"widget":i.find(".field-mm-widget-option").show(),i.find(".field-mm-widget-area").show()}},_dropWidget:function(e){e.preventDefault();var t=u(this),a=u(".ast-select-widget").val(),i=t.closest(".astra-mm-options-wrap"),s=i.data("menu-item"),n=i.find(".ast-drop-widget-nonce").val();if(""!=a){u(".ast-widget-list").show();var d={action:"ast_add_widget",widget_id:a,menu_item_id:s,title:u(".ast-select-widget").find("option:selected").text(),security_nonce:n};u.post(ajaxurl,d,function(e){var t=u(e.data);i.find(".ast-widget-list").append(t),u(".ast-select-widget").val("")})}},_editWidget:function(){var i=u(this).closest(".widget"),t=i.find(".widget-inner"),s=i.attr("id");i.toggleClass("menu-item-edit-active");var e={action:"ast_edit_widget",widget_id:s};i.hasClass("open")||i.data("loaded")?i.toggleClass("open"):u.post(ajaxurl,e,function(e){t.html(e.data),i.data("loaded",!0).toggleClass("open"),i.is("[id*=black-studio-tinymce]")&&bstw(i).deactivate().activate(),setTimeout(function(){u(document).trigger("widget-added",[i])},100),i.find(".delete").on("click",function(e){e.preventDefault();var t=i.find(".ast-delete-widget-nonce").val(),a={action:"ast_delete_widget",widget_id:s,security_nonce:t};u.post(ajaxurl,a,function(e){i.remove()})}),i.find(".close").on("click",function(e){e.preventDefault(),i.toggleClass("open")}),i.find(".ast-save-widget").on("click",function(e){e.preventDefault();var t=i.find("form").serialize(),a=u(this);a.attr("disabled","disabled"),i.find(".spinner").css("visibility","visible"),u.post(ajaxurl,t,function(e){i.find(".spinner").css("visibility","hidden"),a.removeAttr("disabled")})})})},_renderSavedWidgets:function(a,e){var t={action:"ast_render_widgets",menu_item_id:e,security_nonce:a.find(".ast-render-widgets-nonce").val()};u.post(ajaxurl,t,function(e){var t=e.data.html;e.data.has_widgets&&u(".ast-widget-list").show(),a.find(".ast-widget-list").html(t),u("#ast-widget-sortable").sortable(),u("#ast-widget-sortable").disableSelection()})},_saveMegamenuOptions:function(){var t=u(this),e=t.closest(".astra-mm-options-wrap"),a=e.data("menu-item"),i=u("#nav-menu-meta-object-id").val(),s=[],n=e.find(".ast-nonce-field").val();u(".astra-mm-cta-wrap .spinner").css("visibility","visible"),t.text(astMegamenuVars.saving_text),t.attr("disabled","disabled");var d={};e.find("select, textarea, input").each(function(){var e=u(this);if(!(0<e.closest(".astra-mm-settings-wrap").find(".ast-widget-list").length||e.hasClass("ast-nonce-field"))){var t=e.attr("name"),a=e.val();"checkbox"==e.attr("type")&&(e.is(":checked")||(a="")),"textarea"==e.tagName&&(a=u(this).text()),void 0!==t&&(d[t]=a)}}),u("#ast-widget-sortable > .widget").each(function(){var e=u(this).index(),t=u(this).attr("id");s[e]=t});var o={action:"ast_save_menu_options",menu_item_id:a,nav_id:i,widgets:s,options:d,security_nonce:n};u.post(ajaxurl,o,function(e){t.text(astMegamenuVars.saved_text),u(".astra-mm-cta-wrap .spinner").css("visibility","hidden"),setTimeout(function(){t.text(t.data("label")),t.removeAttr("disabled")},1e3)})}},AstMegaMenuAdmin.init()}(jQuery);